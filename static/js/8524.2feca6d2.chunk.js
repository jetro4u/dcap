"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[8524],{88524:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var i=a(30969),n=a(95803),s=a.n(n),o=a(4716),r=a(44765),l=a(28253),c=a(83198),d=a(12395),m=a(3562),h=a(16692),u=a(75192),p=a(64640),g=a(53737),v=a(80150),f=a(71363),b=a(81856);a(94354);var S=e=>{if(!e.children)return i.createElement(i.Fragment,null);const t=e.activeTab||e.children[0].props.name,a=e.children.map((e=>e.props.name));return i.createElement(i.Fragment,null,i.createElement("section",{className:(0,b.Z)("tab-list-block",e.tabHeaderClass||"")},i.createElement("ul",{className:"left"===e.headerPosition?"text-left":"text-right"},a.map(((n,s)=>i.createElement("li",{key:s,className:"inline-block"},i.createElement("button",{type:"button",name:n,className:(0,b.Z)("tab-list-item",t===n?"active round-corner-left round-corner-right":"",0===s?"round-corner-left":"",s===a.length-1?"round-corner-right":""),onClick:e.changeActiveTab},n)))))),i.createElement("section",null,e.children.filter((e=>e.props.name===t))))};function E(e){let{questionNumber:t,total:a}=e;return i.createElement("div",{className:"progress-container"},i.createElement("div",{className:"progress",style:{width:t/a*100+"%"}}))}var N=a(27843),q=a(11681),Q=a(35436),C=a(7518);function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},P.apply(this,arguments)}function U(e){return i.createElement(C.Z,{options:e.options,autoHighlight:!0,blurOnSelect:!0,disablePortal:!0,id:"combo-box-demo",value:e.value,onChange:(t,a)=>{e.onChange(a,e.id)},getOptionLabel:e.getOptionLabel,isOptionEqualToValue:e.isOptionEqualToValue,renderOption:e.renderOption,renderInput:t=>i.createElement(Q.Z,P({},t,{label:e.label}))})}var I=JSON.parse('{"a":[{"period":"","orgUnit":"","id":1,"name":"Utilization of Service","totalQuestions":"5","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":2,"name":"Ante Natal Care","totalQuestions":"18","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":3,"name":"Deliveries","totalQuestions":"1","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":4,"name":"Post Natal Care","totalQuestions":"1","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":5,"name":"Family Planning","totalQuestions":"7","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":6,"name":"HIV and TB","totalQuestions":"11","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":7,"name":"Malaria and Fever","totalQuestions":"6","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":8,"name":"Nutrition","totalQuestions":"8","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":9,"name":"Child Health And Integrated Management of Childhood Illnesses","totalQuestions":"5","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":10,"name":"Immunization","totalQuestions":"4","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":11,"name":"OPD Register","totalQuestions":"6","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":12,"name":"Cash Book Register","totalQuestions":"3","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":13,"name":"Mortality","totalQuestions":"2","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":14,"name":"Surveillance","totalQuestions":"5","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":15,"name":"Emergency Transportation for Reproductive Maternal And Newborn Services","totalQuestions":"2","attemptedQuestions":"0","obtainedValue":"0"},{"period":"","orgUnit":"","id":16,"name":"Cervical Cancer Secondary Prevention Services","totalQuestions":"11","attemptedQuestions":"0","obtainedValue":"0"}]}');function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}console.log("data.data",I.a);const D=r.lW.from("admin:district","utf8").toString("base64");class O extends i.Component{constructor(e){var t;super(e),t=this,y(this,"fetchDE",(e=>{s().get("http://localhost:8004/api/v1.0/forms/questions",{headers:{Authorization:`Basic ${D}`,"content-type":"application/json; charset=utf-8"}}).then((t=>{console.log("res",t),q.Z.setSingle("dataset-data-elements",e,t.data.data)})).catch((e=>console.error(e)))})),y(this,"fetchDatasets",(()=>{s().get("http://localhost:8080/api/dataSets.json?paging=false&fields=id,name",{headers:{Authorization:`Basic ${D}`}}).then((e=>{if(localStorage.setItem("dataset-lists",e.data.dataSets),e&&e.data.dataSets.length)this.setState({datasetlists:e.data.dataSets||[]});else{const e=localStorage.getItem("dataset-lists");this.setState({datasetlists:e||[]})}})).catch((e=>console.error(e)))})),y(this,"fetchOrgUnits",(()=>{s().get("http://localhost:8080/api/organisationUnits.json?paging=false&fields=id,name",{headers:{Authorization:`Basic ${D}`}}).then((e=>{if(localStorage.setItem("organisation-units",e.data.organisationUnits),e&&e.data.organisationUnits.length)this.setState({orgunits:e.data.organisationUnits||[]});else{const e=localStorage.getItem("organisation-units");this.setState({orgunits:e||[]})}})).catch((e=>console.error(e)))})),y(this,"fetchFrequencies",(()=>{s().get("http://localhost:8080/api/33/dataStore/PERIOD/v1",{headers:{Authorization:`Basic ${D}`}}).then((e=>{if(localStorage.setItem("periods",e.data.frequency),e&&e.data.frequency.length)this.setState({frequencies:e.data.frequency||[]});else{const e=localStorage.getItem("periods");this.setState({frequencies:e||[]})}})).catch((e=>console.error(e)))})),y(this,"fetchDatasetSections",(e=>{s().get("http://localhost:8004/api/v1.0/forms/sections",{headers:{Authorization:`Basic ${D}`,"content-type":"application/json; charset=utf-8"}}).then((t=>{q.Z.setSingle("dataset-sections",e,t.data.data)})).catch((e=>console.error(e)))})),y(this,"updateQuestionAttemptCounter",(e=>{const t=localStorage.getItem("period"),a=localStorage.getItem("orgUnitId");(0,N.do)(e).then((i=>{var n=i.filter((e=>e.period==t&&e.orgunit==a));if(n){var s=n.reduce(((e,t)=>{var a=t.sectionid;return e.hasOwnProperty(a)||(e[a]=0),e[a]++,e}),{});q.Z.getFormSectionsOverview(e).then((t=>{if(t&&t.length){let a=Object.keys(s);t.map((e=>(a.indexOf(`${e.id}`)>=0?e.attemptedQuestions=s[`${e.id}`]:e.attemptedQuestions=0,e))),(0,N.zW)(e,t)}})).catch((e=>{}))}else q.Z.getFormSectionsOverview(e).then((t=>{t&&t.length&&t.map((e=>(e.attemptedQuestions=0,e))),(0,N.zW)(e,t)}))}))})),y(this,"fetchSectionOverview",(e=>{q.Z.getFormSectionsOverview(e).then((e=>{this.setState({sections:e&&e||[]})})).catch((e=>{}))})),y(this,"redirectToKPISectionPage",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";var a="/data-capture-app/section?section="+e;t.qParams.id&&(a+=`&dataset=${t.qParams.id}`),t.props.navigate(a)})),y(this,"displaySections",(e=>"2YYUEZ6I1r9"?this.state.sections.map(((e,t)=>i.createElement("div",{className:"section-item",key:t,tabIndex:"0",onClick:()=>this.redirectToKPISectionPage(e.id)},i.createElement("p",{className:"third-header"},e.name),i.createElement("span",{className:"count-span"},e.attemptedQuestions||0," / ",e.totalQuestions||0," Attempted"),i.createElement(E,{total:e.totalQuestions,questionNumber:e.attemptedQuestions})))):this.state.sections.map(((e,t)=>i.createElement("div",{className:"section-item",key:t,tabIndex:"0"},i.createElement("p",{className:"third-header"},e.name),i.createElement("span",{className:"count-span"},e.attemptedQuestions||0," / ",e.totalQuestions||0," Attempted"),i.createElement(E,{total:e.totalQuestions,questionNumber:e.attemptedQuestions})))))),y(this,"setDataset",(()=>{const e=localStorage.getItem("dataset");this.setState({activeDatasetId:e,activeTab:"Sections"},(()=>{this.fetchSectionOverview(e),this.fetchDE(e),this.fetchDatasetSections(e),this.updateQuestionAttemptCounter(e),this.props.navigate(`/data-capture-app?tab=${this.state.activeTab}&id=${e}`)}))})),y(this,"changeActiveTab",(e=>{var t=`/data-capture-app?tab=${e}`;this.setState({activeTab:e,doneStep1:!0},(()=>{["Home"].indexOf(e)<0&&this.state.activeDatasetId&&(t+=`&id=${this.state.activeDatasetId}`),this.props.navigate(t)}))})),y(this,"changeHomeActiveTab",(e=>{var t=`/data-capture-app?tab=${e.target.value}`;this.setState({activeTab:e.target.value},(()=>{["Home"].indexOf(e.target.value)<0&&this.state.activeDatasetId&&(t+=`&id=${this.state.activeDatasetId}`),this.props.navigate(t)}))})),y(this,"handleDatasetChange",(e=>{const{data:t}=this.state;t.dataset=e,this.setState({data:t,datasetName:e.name}),localStorage.setItem("dataset",e.id),this.fetchDatasets(e.id)})),y(this,"handleOrgUnitChange",(e=>{const{data:t}=this.state;t.orgUnit=e,this.setState({data:t,orgUnitName:e.name}),localStorage.setItem("orgUnit",e.name),localStorage.setItem("orgUnitId",e.id)})),y(this,"handleFrequencyChange",(e=>{const{data:t}=this.state;let{periods:a}=this.state;t.frequency=e;a=this.state.frequencies.find((t=>t.value===e.value)).period,this.setState({data:t,periods:a})})),y(this,"handlePeriodChange",(e=>{const{data:t}=this.state;t.period=e,this.setState({data:t,periodName:e.name}),localStorage.setItem("period",e.value)})),y(this,"renderArrow",(e=>{if("Sections"===e)return i.createElement(i.Fragment,null,i.createElement(o.rU,{className:"sup-back-link",role:"button",to:"/data-capture-app"},i.createElement("span",{className:"material-icons"},"arrow_back")),i.createElement("h2",{className:"sup-header inline-block sup-header-edit"},"Back to landing page"))})),y(this,"renderTopSection",(()=>this.qParams.id&&"Sections"===this.state.activeTab?i.createElement("section",{className:"facitlity-detail"},i.createElement("div",{className:"detail-section inline-block"},i.createElement("h2",{className:"name-header"},this.state.orgUnit))):null)),this.state={error:{},data:{},sections:[],orgunits:[],frequencies:[],periods:[],datasetlists:[],orgUnit:"",activeTab:"Home",activeDataset:"",activeDatasetId:null,dataset:[],deGroup:[],orgUnitName:"",datasetName:"",periodName:"",doneStep1:!1},this.qParams=(0,f.vl)(window.location.search),this.qParams&&this.qParams.tab&&(this.state.activeTab=this.qParams.tab),this.qParams&&this.qParams.id&&(this.state.activeDatasetId=this.qParams.id)}componentDidMount(){this.qParams&&this.qParams.id&&(this.updateQuestionAttemptCounter(this.qParams.id),this.fetchDE(this.qParams.id),this.fetchDatasetSections(this.qParams.id),this.fetchSectionOverview(this.qParams.id)),q.Z.setSingle("dataset-sections-overview","2YYUEZ6I1r9",I.a),this.fetchDatasets(),this.fetchOrgUnits(),this.fetchFrequencies()}componentDidUpdate(e,t){this.qParams=(0,f.vl)(window.location.search),this.qParams&&this.qParams.id!==t.activeDatasetId&&this.setState({activeDatasetId:this.qParams.id})}render(){const{doneStep1:e,periods:t,frequencies:a,activeTab:n,datasetlists:s,data:o,error:r,orgunits:l,datasetName:c,orgUnitName:d,periodName:v,activeDatasetId:f}=this.state;return i.createElement("div",{className:"overview-container"},i.createElement("div",{className:"row-container"},this.renderTopSection(),i.createElement(m.Z,{variant:"outlined",className:"tab-select"},i.createElement("label",null,"Select Section"),i.createElement(h.Z,{onChange:this.changeHomeActiveTab,value:n||null},i.createElement(u.Z,{value:"Home"},"Step 1 - Select Dataset"),i.createElement(u.Z,{value:"Confirm"},"Step 2 - Form Confirmation"),i.createElement(u.Z,{value:"Sections"},"Step 3 - Submit Report")))),i.createElement("div",{className:"row-container"},i.createElement(S,{activeTab:n,headerPosition:"center",tabHeaderClass:"custom-pos"},i.createElement("section",{className:"supervision-list-block",name:"Home"},i.createElement(m.Z,{className:"form-control mt-20",fullWidth:!0,error:r.frequency},i.createElement(U,{freeSolo:!1,variant:"outlined",options:a,name:"frequency",value:o.frequency||null,onChange:this.handleFrequencyChange,labelField:"name",valueField:"value",label:"Select Frequency",getOptionLabel:e=>e.name||"",error:r.frequency}),i.createElement(p.Z,null,r.frequency)),i.createElement(m.Z,{className:"form-control mt-10",fullWidth:!0,error:r.period},i.createElement(U,{freeSolo:!1,variant:"outlined",options:t,name:"period",value:o.period||null,onChange:this.handlePeriodChange,labelField:"name",valueField:"value",getOptionLabel:e=>e.name||"",error:r.period}),i.createElement(p.Z,null,r.period)),i.createElement(m.Z,{fullWidth:!0,className:"form-control mt-10"},i.createElement(U,{freeSolo:!1,variant:"outlined",options:l,value:o.orgUnit||null,onChange:this.handleOrgUnitChange,label:"Organisation Unit",labelField:"name",valueField:"id",getOptionLabel:e=>e.name||"",error:!!r.id}),i.createElement(p.Z,{className:"form-error"},r.id)),i.createElement(m.Z,{fullWidth:!0,className:"form-control mt-10"},i.createElement(U,{freeSolo:!1,variant:"outlined",options:s,value:o.dataset||null,onChange:this.handleDatasetChange,label:"Select Dataset",labelField:"name",valueField:"id",getOptionLabel:e=>e.name||"",error:!!r.id}),i.createElement(p.Z,{className:"form-error"},r.id)),i.createElement(g.Z,{className:"next-btn",onClick:()=>this.changeActiveTab("Confirm")},"Confirm Selection")),i.createElement("section",{className:"supervision-list-block",name:"Confirm"},i.createElement("h2",{className:"secondary-header"},"Dataset Confirmation"),e?i.createElement(i.Fragment,null,i.createElement("div",{className:"p-24"},i.createElement("p",null,"Please confirm that you are submitting ",i.createElement("strong",null,c)," for ",i.createElement("strong",null,d)," for the period ",i.createElement("strong",null,v),". If the details are correct click the button below to submit your report."),i.createElement("br",null),i.createElement("p",null,"Otherwise click the ",i.createElement("strong",null,"Step 1 - Select Dataset")," from the drop down menu above to start all over.")),i.createElement("div",{className:"btn-container"},i.createElement(g.Z,{variant:"outlined",color:"primary",onClick:()=>{this.setDataset()}},"Submit Report"))):i.createElement("p",null,"You have skipped the first step. Click the ",i.createElement("strong",null,"Step 1 - Select Dataset")," from the drop down menu above to start all over.")),i.createElement("section",{className:"supervision-list-block",name:"Sections"},i.createElement("h2",{className:"secondary-header"},"Submit Reports"),this.qParams.id?i.createElement(i.Fragment,null,this.displaySections(this.qParams.id)):i.createElement("p",null,"You have skipped the first step. Click the ",i.createElement("strong",null,"Step 1 - Select Dataset")," from the drop down menu above to start all over.")))))}}var k=(0,c.$j)(null,(function(e){return(0,d.DE)({showMessage:v.PV},e)}))((0,l.Z)(O))}}]);
//# sourceMappingURL=8524.2feca6d2.chunk.js.map